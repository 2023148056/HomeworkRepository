<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>index</title>
    <link rel="stylesheet" type="text/css" href="main.css">
</head>
<body>
    <div class="header-container">
        <h1 class="sliding-text">μΈν”„λ° μν™” μ •λ³΄ μ‚¬μ΄νΈ μ…λ‹λ‹¤.</h1>
    </div>

    <nav class="flexible-container">
        <a href="index.html" class="active-link">λ©”μΈνμ΄μ§€</a>
        <a href="login.html">λ΅κ·ΈμΈ</a>
        <a href="signup.html">νμ› κ°€μ…</a>
    </nav>
    <hr>
    <main class="main-container">
        <section class="search-section">
            <input type="text" id="search" placeholder="ν‚¤μ›λ“λ¥Ό μ…λ ¥ν•μ„Έμ”.">
            <button id="filter-button">Filter results</button>
        </section>
        <section class="movies-section">
            <div class="movies-header">
                <h2>Movies</h2>
                <hr>
            </div>
            <div class="main-content">
                <div id="sort-box">
                    <strong>μ •λ ¬ κΈ°μ¤€</strong><br><br>
                    <label><input type="radio" name="sort" value="rating-desc"> ν‰μ  λ‚΄λ¦Όμ°¨μ</label><br>
                    <label><input type="radio" name="sort" value="rating-asc"> ν‰μ  μ¤λ¦„μ°¨μ</label><br>
                    <label><input type="radio" name="sort" value="date-desc"> κ°λ΄‰ λ‚΄λ¦Όμ°¨μ</label><br>
                    <label><input type="radio" name="sort" value="date-asc"> κ°λ΄‰ μ¤λ¦„μ°¨μ</label>
                </div>
                <div class="movie-container" id="movie-container">
                </div>
            </div>
        </section>
        <section class="about-section">
            <div class="about-header">
                <h2>About</h2>
                <hr>
            </div>
            <div class="about-content">
                <p>
                    μ—¬κΈ°λ” μΈν”„λ° μν™” μ •λ³΄ μ‚¬μ΄νΈ! μ—¬κΈ°λ” μΈν”„λ° μν™” μ •λ³΄ μ‚¬μ΄νΈ! 
                    μ—¬κΈ°λ” μΈν”„λ° μν™” μ •λ³΄ μ‚¬μ΄νΈ! μ—¬κΈ°λ” μΈν”„λ° μν™” μ •λ³΄ μ‚¬μ΄νΈ!
                    μ—¬κΈ°λ” μΈν”„λ° μν™” μ •λ³΄ μ‚¬μ΄νΈ! μ—¬κΈ°λ” μΈν”„λ° μν™” μ •λ³΄ μ‚¬μ΄νΈ!
                    μ—¬κΈ°λ” μΈν”„λ° μν™” μ •λ³΄ μ‚¬μ΄νΈ! μ—¬κΈ°λ” μΈν”„λ° μν™” μ •λ³΄ μ‚¬μ΄νΈ!
                    μ—¬κΈ°λ” μΈν”„λ° μν™” μ •λ³΄ μ‚¬μ΄νΈ! μ—¬κΈ°λ” μΈν”„λ° μν™” μ •λ³΄ μ‚¬μ΄νΈ!
                    μ—¬κΈ°λ” μΈν”„λ° μν™” μ •λ³΄ μ‚¬μ΄νΈ! μ—¬κΈ°λ” μΈν”„λ° μν™” μ •λ³΄ μ‚¬μ΄νΈ!
                </p>
            </div>
        </section>
    </main>
    <script>
        let allMovies = [];
        let currentFiltered = [];
        let currentIndex = 0;
        const BATCH_SIZE = 6;
      
        // JSON λ΅λ“
        fetch('product.json')
          .then(response => response.json())
          .then(data => {
            allMovies = data;
            currentFiltered = allMovies;
            renderMovies(currentFiltered);
          });
      
        // λ λ”λ§ ν•¨μ
        function renderMovies(movieList) {
          const container = document.getElementById('movie-container');
      
          for (let i = currentIndex; i < currentIndex + BATCH_SIZE && i < movieList.length; i++) {
            const movie = movieList[i];
            const card = document.createElement('div');
            card.className = 'movie-card';
      
            card.innerHTML = `
              <div class="poster-wrapper">
                <img src="img/${movie.id}.jpg" alt="${movie.title}" width="200px" height="300px">
                <div class="overlay"><strong>μ¤„κ±°λ¦¬:</strong><br>${movie.overview}</div>
              </div>
              <div class="movie-info">
                <h3>${movie.title}</h3>
                <p>π“… ${movie.release_date}</p>
                <p>β­ ${movie.vote_average}/10</p>
              </div>
            `;
      
            container.appendChild(card);
          }
      
          currentIndex += BATCH_SIZE;
        }
      
        // π” ν•„ν„° λ²„νΌ ν΄λ¦­
        document.getElementById('filter-button').addEventListener('click', function () {
          const keyword = document.getElementById('search').value.toLowerCase();
      
          // ν•„ν„°λ§ μν–‰
          currentFiltered = allMovies.filter(movie =>
            movie.title.toLowerCase().includes(keyword) ||
            movie.overview.toLowerCase().includes(keyword)
          );
      
          // β… μ΄μ „ κ²°κ³Ό μ κ±° λ° μΈλ±μ¤ μ΄κΈ°ν™”
          document.getElementById('movie-container').innerHTML = '';
          currentIndex = 0;
      
          // ν•„ν„°λ§λ λ°μ΄ν„° λ λ”λ§
          renderMovies(currentFiltered);
        });
      
        // π“ infinite scroll
        window.addEventListener('scroll', () => {
          if (window.innerHeight + window.scrollY >= document.body.offsetHeight - 100) {
            renderMovies(currentFiltered);  // β… ν„μ¬ ν•„ν„° κ²°κ³Ό κΈ°λ°μΌλ΅ λ” λ΅λ“
          }
        });

        document.querySelectorAll('input[name="sort"]').forEach(radio => {
            radio.addEventListener('change', (e) => {
                const sortValue = e.target.value;

                // μ •λ ¬λ λ°°μ—΄μ„ λ³µμ‚¬λ³ΈμΌλ΅ μ²λ¦¬
                currentFiltered.sort((a, b) => {
                    switch (sortValue) {
                    case 'rating-desc':
                        return b.vote_average - a.vote_average;
                    case 'rating-asc':
                        return a.vote_average - b.vote_average;
                    case 'date-desc':
                        return new Date(b.release_date) - new Date(a.release_date);
                    case 'date-asc':
                        return new Date(a.release_date) - new Date(b.release_date);
                    }
                });

                // λ λ”λ§ μ΄κΈ°ν™”
                document.getElementById('movie-container').innerHTML = '';
                currentIndex = 0;
                renderMovies(currentFiltered);
            });
        });
    </script>
</body>
</html>
